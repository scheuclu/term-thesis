\documentclass{standalone}
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{struktex}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\def\mainpath{../../}
\def\tikzpath{./}

\usepackage{pgfplots}

\input{\mainpath/colordefinitions}
\input{\mainpath/customcommands}
\begin{document}
\begin{struktogramm}(150,190)
\def\df2{0.40}

\assign{\nassitexttwolines{\df2}{(1) Calculate equilibrium solution with}{regards to rigid body modes} $\lagnvec_0=\scalemat\rmodespace\inv{(\tp{\rmodespace}\scalemat\rmodespace )}\evec$  }
\assign{\nassitext{\df2}{(2) Projector to natural subspace} $\projn=\eyemat - \scalemat\rmodespace\inv{(\tp{\rmodespace}\scalemat\rmodespace)}\tp{\rmodespace}$  }
\assign{\nassitexttwolines{\df2}{(3) Calculate residual(gap) in}{natural subspace} $\resvec_0=\tp{\projn}(\ifacedispvec-\locdualschur\lagvec_0)$  }

\assign{\nassitext{\df2}{(4) Preconditioning} $\hlchange{\Zmat_0=\scaled{\locschur}\resvec_0}$  }



\assign{\nassitext{\df2}{(5) Rigid body-components of forces} $\sdirnspacemat_0=\projn\Zmat_0$}
\assign{\nassitext{\df2}{(6) Initialize} $\lagfvec_0=0, i=0$  }

\while[8]{\nassitextbold{\df2}{While not converged}  $\sqrt{ \tp{\resvec}\Zmat\dmat{1} }>\epsilon$} %8 decribes the with of the while box
\assign{\nassitexttwolines{\df2}{(7) Compute gap-changes}{due to forces $\sdirnspacemat_i$}   $\sdirnspacecspaceblock_{i}=\locdualschur\sdirnspacemat_i$}
\assign{\nassitext{\df2}{(8) Auxiliary parameter}   $\Deltamat_i=\tp{\sdirnspacecspaceblock_i}\sdirnspacemat_i$}
\assign{\nassitext{\df2}{(9) Auxiliary parameter}   $\dvec{\gamma}_i=\tp{\Zmat_i} \resvec_i$  }

\assign{\nassitext{\df2}{(10) Auxiliary parameter}   $\dvec{\alpha}_i = \pinv{\Deltamat_i} \dvec{\gamma}_i$  }



\assign{\nassitext{\df2}{(11) Step in new direction}   $\lagfvec_{i+1}=\lagfvec_i+\sdirnspacemat_i \dvec{\alpha}_i$}
\assign{\nassitext{\df2}{(12) Gap change due to force step}   $\resvec_{i+1}=\resvec_i-\tp{\projn}\sdirnspacecspaceblock_i \dvec{\alpha}_i$}


\assign{\nassitext{\df2}{(13) New} $\hlchange{\Zmat_{i+1}=\scaled{\locschur}\resvec_{i+1}}$  }

\while[8]{\nassitextbold{\df2}{Loop over all substructures }  $\hlchange{ for~s=1,....,N~do }$} %8 decribes the with of the while box
\assign{\nassitext{\df2}{(14) Compute convergence indicator}   $\hlchange{t_i^s = \frac{ \langle \sdirnspacemat_i \dvec{\alpha_i},\asmids{\locdualschur} \sdirnspacemat_i \dvec{\alpha}_i\rangle }{ \tp{\resvec_{i+1}} \asmids{\locschur} \resvec_{i+1} }}$}

%
%            ts=( (W{k}*alpha{k})'*(this.Fs_{s}*W{k}*alpha{k})  )/...
%               ( r(:,k+1)'*this.Sts_{s}*r(:,k+1) );

\ifthenelse[12]{1}{1}
{\nassitext{\df2}{(15) $\tau-test$} $\hlchange{t_i^s<\tau?}$}{\sTrue}{\sFalse}
\assign{\nassitext{\df2}{(16) Add direction to search space}   $\Zmat_{i+1}=[Z_{i+1} | \asmids{\locschur} \resvec_{}]$}
\change
\assign{\nassitext{\df2}{(17) Do nothing} }
\ifend

\whileend


\assign{\nassitexttwolines{\df2}{(18) Remove rigid body-components}{of forces}   $\sdirnspacemat_{i+1}=\projn\Zmat_{i+1}$}

\while[8]{\nassitextbold{\df2}{Loop over previous iterations}  $\text{for:~}0\leq j \leq i$}
\assign{\nassitext{\df2}{(19) Compute orthogonalization factor}   $\dmat{\phi}_{i,j}=\tp{\sdirnspacecspaceblock}_j \sdirnspacemat_{i+1}$}
\assign{\nassitext{\df2}{(20) Orthogonalize to direction j}   $\sdirnspacemat_{i+1} \gets \sdirnspacemat_{i+1}-\sdirnspacemat_j\pinv{\Deltamat_j}\dmat{\phi}_{i,j}$}
\whileend

\assign{\nassitext{\df2}{(21) Increase iteration counter}   $i \gets i+1$}
\whileend
\assign{\nassitext{\df2}{(22) Compute total interface forces}   $\lagvec=\lagnvec_0+\lagfvec_0$}

\end{struktogramm}
\end{document}